<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Booking</title>
  <link rel="stylesheet" href="./header.css">
  <link rel="stylesheet" href="./filter.css">

  <script type="module" src="./app.js" defer></script>
</head>
<body>
  <header>
    <nav class="header-nav">
      <div class="motto">
        <a href="../index.html" aria-label="Home">
          <img width="50px" src="../images/ym2/logo.png" alt="logo" />
        </a>
        <p>
          Таний хүсэлд нийцсэн, хүссэн аяллалыг тань<br />
          <strong style="font-weight: 600">бид бүтээж өгнө</strong>
        </p>
      </div>
      <ul class="nav-links">
        <li><a href="./aboutUs.html" aria-label="Learn more about us">Бидний тухай</a></li>
        <li><a href="./zahialah.html" aria-label="Book your trip">Аялал захиалах</a></li>
        <li><a href="./mytravels.html" aria-label="Navigate through your trips">Миний аяллууд</a></li>
        <li><a href="./travels.html" aria-label="Deep dive into our travelling options">Аяллууд</a></li>
      </ul>
      <section class="user-links">
        <button id="toggle-theme" aria-label="Switch mode">
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#080d21">
            <path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Zm-10-270Z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#080d21">
            <path d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z" />
          </svg>
        </button>
        <div class="cart-container" id="cart-container">
          <cart-icon></cart-icon>
          <cart-comp data-total-price>
            <span slot="item"></span>
          </cart-comp>
        </div>
        <a href="./signin.html" aria-label="Sign in to your account">Нэвтрэх</a>
        <a href="./signin.html" aria-label="Sign in to your account">
          <img src="../images/ym2/account_icon.png" alt="account icon" />
        </a>
      </section>
    </nav>
  </header>
  <main>
    <h1>Booking</h1>
    <div id="cart-items"></div>
    <section class="travels-container">
      <div id="travel-grid"></div> <!-- Add this container to display travel info -->
    <form id="booking-form">
      <label for="number_of_travelers">Number of Travelers:</label>
      <input type="number" name="number_of_travelers" id="number_of_travelers" required>
      <button type="submit">Book Now</button>
    </form>
    <div id="booking-message" style="color: red;"></div>
  </main>
  <footer>
    <div class="footer-container">
      <section class="footer-first">
        <div class="footer-logo">
          <img src="../images/ym2/logo.png" alt="Logo" />
          <p>
            нууц <br />
            аялал
          </p>
        </div>
        <div class="social-icons">
          <ul>
            <li>
              <a style="color: white" href="#" aria-label="Facebook">
                <i style="font-size: 34px" class="fa-brands fa-square-facebook"></i>
              </a>
            </li>
            <li>
              <a style="color: white" href="#" aria-label="Twitter">
                <i style="font-size:34px" class="fa-brands fa-twitter"></i>
                              </a>
                            </li>
                            <li>
                              <a style="color: white" href="#" aria-label="Instagram">
                                <i style="font-size: 34px" class="fa-brands fa-instagram"></i>
                              </a>
                            </li>
                          </ul>
                        </div>
                      </section>
                      <section class="footer-links">
                        <h4>Бидний тухай</h4>
                        <ul>
                          <li><a href="./aboutUs.html">Танилцуулга</a></li>
                          <li><a href="./FaQ.html">Асуулт хариулт</a></li>
                        </ul>
                      </section>
                      <section class="footer-contact">
                        <h4>Холбоо барих</h4>
                        <ul>
                          <li>
                            <p>
                              и-мэйл:
                              <a href="mailto:nuutsaylal@gmail.com" aria-label="Mail to us">nuutsaylal@gmail.com</a>
                            </p>
                          </li>
                          <li><p>Phone: +976 99999999</p></li>
                        </ul>
                      </section>
                      <section class="footer-address">
                        <h4>Манай хаяг</h4>
                        <p>
                          Их сургуулийн гудамж - 1, Бага тойруу, Сүхбаатар дүүрэг, Улаанбаатар
                        </p>
                      </section>
                    </div>
                  </footer>


                  <script>
                    document.getElementById('booking-form').addEventListener('submit', async function(e) {
                      e.preventDefault();
                  
                      const number_of_travelers = document.getElementById('number_of_travelers').value;
                      const travel_id = new URLSearchParams(window.location.search).get('travelIds'); // Retrieve travel_id from query parameters
                      const date = new Date().toISOString(); // Set the booking date to the current date
                      const status = "Pending"; // Default status
                  
                      // Retrieve the price per traveler from localStorage or another source
                      const price_per_traveler = 300000;
                  
                      const total_price = number_of_travelers * price_per_traveler; // Calculate the total price
                  
                      const token = localStorage.getItem("authToken");
                  
                      if (!token) {
                        alert("You need to be logged in to make a booking.");
                        return;
                      }
                  
                      try {
                        const response = await fetch('/api/bookings', {
                          method: 'POST',
                          headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`,
                          },
                          body: JSON.stringify({
                            travel_id: travel_id,
                            date: date,
                            status: status,
                            number_of_travelers: number_of_travelers,
                            total_price: total_price,
                          })
                        });
                  
                        const result = await response.json();
                        if (response.ok) {
                          alert('Booking Successful!');
                          // Handle successful booking logic here
                        } else {
                          document.getElementById('booking-message').innerText = result.message || 'Error making booking';
                        }
                      } catch (error) {
                        console.error("Error making booking:", error);
                        document.getElementById('booking-message').innerText = 'Error making booking';
                      }
                    });
                  </script>
                </body>
                </html>
